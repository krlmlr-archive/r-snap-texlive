% This file installs three samples-variants of setting
% of Continued and Finished pages of long table
\begin{filecontents}{r-longtable.tex}
\begin{longtable}{@{}lll}
\caption{The ISOGRK3 entity set and more more more more more more more more more
   more more more more more more more more more text}\\
   \bfseries Entity&\bfseries  Unicode Name&\bfseries  Unicode\\ \hline
\endfirsthead
\LTcontcaption{}\\
   \bfseries Entity&\bfseries  Unicode Name&\bfseries  Unicode\\ \hline
\endhead
\LTfincaption{}\\
   \bfseries Entity&\bfseries  Unicode Name&\bfseries  Unicode\\ \hline
\endlasthead
   \hline \multicolumn{3}{@{}r@{}}{(\emph{продолжение на сл. странице})}
\endfoot
   \hline \multicolumn{3}{@{}r@{}}{(\emph{окончание на сл. странице})}
\endprelastfoot
   \hline
\endlastfoot
alpha              & GREEK SMALL LETTER ALPHA            & 03B1\\
beta               & GREEK SMALL LETTER BETA             & 03B2\\
chi                & GREEK SMALL LETTER CHI              & 03C7\\
\empty
Delta              & GREEK CAPITAL LETTER DELTA          & 0394\\
delta              & GREEK SMALL LETTER DELTA            & 03B4\\
epsi               & GREEK SMALL LETTER EPSILON          & 03B5\\
epsis              & GREEK LUNATE EPSILON SYMBOL         & 03F5\\
epsiv              & GREEK SMALL LETTER EPSILON          & 03B5\\
eta                & GREEK SMALL LETTER ETA              & 03B7\\
Gamma              & GREEK CAPITAL LETTER GAMMA          & 0393\\
gamma              & GREEK SMALL LETTER GAMMA            & 03B3\\
gammad             & GREEK SMALL LETTER DIGAMMA          & 03DD\\
iota               & GREEK SMALL LETTER IOTA             & 03B9\\
kappa              & GREEK SMALL LETTER KAPPA            & 03BA\\
kappav             & GREEK KAPPA SYMBOL                  & 03F0\\
Lambda             & GREEK CAPITAL LETTER LAMDA          & 039B\\
lambda             & GREEK SMALL LETTER LAMDA            & 03BB\\
mu                 & GREEK SMALL LETTER MU               & 03BC\\
nu                 & GREEK SMALL LETTER NU               & 03BD\\
Omega              & GREEK CAPITAL LETTER OMEGA          & 03A9\\
omega              & GREEK SMALL LETTER OMEGA            & 03C9\\
Phi                & GREEK CAPITAL LETTER PHI            & 03A6\\
phis               & GREEK PHI SYMBOL                    & 03D5\\
phiv               & GREEK SMALL LETTER PHI              & 03C6\\
Pi                 & GREEK CAPITAL LETTER PI             & 03A0\\
pi                 & GREEK SMALL LETTER PI               & 03C0\\
piv                & GREEK PI SYMBOL                     & 03D6\\
Psi                & GREEK CAPITAL LETTER PSI            & 03A8\\
psi                & GREEK SMALL LETTER PSI              & 03C8\\
rho                & GREEK SMALL LETTER RHO              & 03C1\\
rhov               & GREEK RHO SYMBOL                    & 03F1\\
Sigma              & GREEK CAPITAL LETTER SIGMA          & 03A3\\
sigma              & GREEK SMALL LETTER SIGMA            & 03C3\\
sigmav             & GREEK SMALL LETTER FINAL SIGMA      & 03C2\\
tau                & GREEK SMALL LETTER TAU              & 03C4\\
Theta              & GREEK CAPITAL LETTER THETA          & 0398\\
thetas             & GREEK SMALL LETTER THETA            & 03B8\\
thetav             & GREEK THETA SYMBOL                  & 03D1\\
Upsi               & GREEK UPSILON WITH HOOK SYMBOL      & 03D2\\
upsi               & GREEK SMALL LETTER UPSILON          & 03C5\\
Xi                 & GREEK CAPITAL LETTER XI             & 039E\\
xi                 & GREEK SMALL LETTER XI               & 03BE\\
zeta               & GREEK SMALL LETTER ZETA             & 03B6\\
%
%
%
alpha              &  SMALL LETTER ALPHA            & 03B1\\
beta               &  SMALL LETTER BETA             & 03B2\\
chi                &  SMALL LETTER CHI              & 03C7\\
\empty
Delta              &  CAPITAL LETTER DELTA          & 0394\\
delta              &  SMALL LETTER DELTA            & 03B4\\
epsi               &  SMALL LETTER EPSILON          & 03B5\\
epsis              &  LUNATE EPSILON SYMBOL         & 03F5\\
epsiv              &  SMALL LETTER EPSILON          & 03B5\\
eta                &  SMALL LETTER ETA              & 03B7\\
Gamma              &  CAPITAL LETTER GAMMA          & 0393\\
gamma              &  SMALL LETTER GAMMA            & 03B3\\
gammad             &  SMALL LETTER DIGAMMA          & 03DD\\
iota               &  SMALL LETTER IOTA             & 03B9\\
kappa              &  SMALL LETTER KAPPA            & 03BA\\
kappav             &  KAPPA SYMBOL                  & 03F0\\
Lambda             &  CAPITAL LETTER LAMDA          & 039B\\
lambda             &  SMALL LETTER LAMDA            & 03BB\\
mu                 &  SMALL LETTER MU               & 03BC\\
nu                 &  SMALL LETTER NU               & 03BD\\
Omega              &  CAPITAL LETTER OMEGA          & 03A9\\
omega              &  SMALL LETTER OMEGA            & 03C9\\
Phi                &  CAPITAL LETTER PHI            & 03A6\\
phis               &  PHI SYMBOL                    & 03D5\\
phiv               &  SMALL LETTER PHI              & 03C6\\
Pi                 &  CAPITAL LETTER PI             & 03A0\\
pi                 &  SMALL LETTER PI               & 03C0\\
piv                &  PI SYMBOL                     & 03D6\\
Psi                &  CAPITAL LETTER PSI            & 03A8\\
psi                &  SMALL LETTER PSI              & 03C8\\
rho                &  SMALL LETTER RHO              & 03C1\\
rhov               &  RHO SYMBOL                    & 03F1\\
Sigma              &  CAPITAL LETTER SIGMA          & 03A3\\
sigma              &  SMALL LETTER SIGMA            & 03C3\\
sigmav             &  SMALL LETTER FINAL SIGMA      & 03C2\\
tau                &  SMALL LETTER TAU              & 03C4\\
Theta              &  CAPITAL LETTER THETA          & 0398\\
thetas             &  SMALL LETTER THETA            & 03B8\\
thetav             &  THETA SYMBOL                  & 03D1\\
Upsi               &  UPSILON WITH HOOK SYMBOL      & 03D2\\
upsi               &  SMALL LETTER UPSILON          & 03C5\\
Xi                 &  CAPITAL LETTER XI             & 039E\\
xi                 &  SMALL LETTER XI               & 03BE\\
zeta               &  SMALL LETTER ZETA             & 03B6\\
%
%
%
alpha              &  SMALL LETTER ALPHA            & 03B1\\
beta               &  SMALL LETTER BETA             & 03B2\\
chi                &  SMALL LETTER CHI              & 03C7\\
\empty
Delta              &  CAPITAL LETTER DELTA          & 0394\\
delta              &  SMALL LETTER DELTA            & 03B4\\
epsi               &  SMALL LETTER EPSILON          & 03B5\\
epsis              &  LUNATE EPSILON SYMBOL         & 03F5\\
epsiv              &  SMALL LETTER EPSILON          & 03B5\\
eta                &  SMALL LETTER ETA              & 03B7\\
Gamma              &  CAPITAL LETTER GAMMA          & 0393\\
gamma              &  SMALL LETTER GAMMA            & 03B3\\
gammad             &  SMALL LETTER DIGAMMA          & 03DD\\
iota               &  SMALL LETTER IOTA             & 03B9\\
kappa              &  SMALL LETTER KAPPA            & 03BA\\
kappav             &  KAPPA SYMBOL                  & 03F0\\
Lambda             &  CAPITAL LETTER LAMDA          & 039B\\
lambda             &  SMALL LETTER LAMDA            & 03BB\\
mu                 &  SMALL LETTER MU               & 03BC\\
nu                 &  SMALL LETTER NU               & 03BD\\
Omega              &  CAPITAL LETTER OMEGA          & 03A9\\
omega              &  SMALL LETTER OMEGA            & 03C9\\
Phi                &  CAPITAL LETTER PHI            & 03A6\\
phis               &  PHI SYMBOL                    & 03D5\\
phiv               &  SMALL LETTER PHI              & 03C6\\
Pi                 &  CAPITAL LETTER PI             & 03A0\\
pi                 &  SMALL LETTER PI               & 03C0\\
piv                &  PI SYMBOL                     & 03D6\\
Psi                &  CAPITAL LETTER PSI            & 03A8\\
psi                &  SMALL LETTER PSI              & 03C8\\
rho                &  SMALL LETTER RHO              & 03C1\\
rhov               &  RHO SYMBOL                    & 03F1\\
Sigma              &  CAPITAL LETTER SIGMA          & 03A3\\
sigma              &  SMALL LETTER SIGMA            & 03C3\\
sigmav             &  SMALL LETTER FINAL SIGMA      & 03C2\\
tau                &  SMALL LETTER TAU              & 03C4\\
Theta              &  CAPITAL LETTER THETA          & 0398\\
thetas             &  SMALL LETTER THETA            & 03B8\\
thetav             &  THETA SYMBOL                  & 03D1\\
Upsi               &  UPSILON WITH HOOK SYMBOL      & 03D2\\
upsi               &  SMALL LETTER UPSILON          & 03C5\\
Xi                 &  CAPITAL LETTER XI             & 039E\\
xi                 &  SMALL LETTER XI               & 03BE\\
zeta               &  SMALL LETTER ZETA             & 03B6\\
%
%
%
alpha              &  SMALL LETTER ALPHA            & 03B1\\
beta               &  SMALL LETTER BETA             & 03B2\\
chi                &  SMALL LETTER CHI              & 03C7\\
\empty
Delta              &  CAPITAL LETTER DELTA          & 0394\\
delta              &  SMALL LETTER DELTA            & 03B4\\
epsi               &  SMALL LETTER EPSILON          & 03B5\\
epsis              &  LUNATE EPSILON SYMBOL         & 03F5\\
epsiv              &  SMALL LETTER EPSILON          & 03B5\\
eta                &  SMALL LETTER ETA              & 03B7\\
Gamma              &  CAPITAL LETTER GAMMA          & 0393\\
gamma              &  SMALL LETTER GAMMA            & 03B3\\
gammad             &  SMALL LETTER DIGAMMA          & 03DD\\
iota               &  SMALL LETTER IOTA             & 03B9\\
kappa              &  SMALL LETTER KAPPA            & 03BA\\
kappav             &  KAPPA SYMBOL                  & 03F0\\
Lambda             &  CAPITAL LETTER LAMDA          & 039B\\
lambda             &  SMALL LETTER LAMDA            & 03BB\\
mu                 &  SMALL LETTER MU               & 03BC\\
nu                 &  SMALL LETTER NU               & 03BD\\
Omega              &  CAPITAL LETTER OMEGA          & 03A9\\
omega              &  SMALL LETTER OMEGA            & 03C9\\
Phi                &  CAPITAL LETTER PHI            & 03A6\\
phis               &  PHI SYMBOL                    & 03D5\\
phiv               &  SMALL LETTER PHI              & 03C6\\
Pi                 &  CAPITAL LETTER PI             & 03A0\\
pi                 &  SMALL LETTER PI               & 03C0\\
piv                &  PI SYMBOL                     & 03D6\\
Psi                &  CAPITAL LETTER PSI            & 03A8\\
psi                &  SMALL LETTER PSI              & 03C8\\
rho                &  SMALL LETTER RHO              & 03C1\\
rhov               &  RHO SYMBOL                    & 03F1\\
Sigma              &  CAPITAL LETTER SIGMA          & 03A3\\
sigma              &  SMALL LETTER SIGMA            & 03C3\\
sigmav             &  SMALL LETTER FINAL SIGMA      & 03C2\\
tau                &  SMALL LETTER TAU              & 03C4\\
Theta              &  CAPITAL LETTER THETA          & 0398\\
thetas             &  SMALL LETTER THETA            & 03B8\\
thetav             &  THETA SYMBOL                  & 03D1\\
Upsi               &  UPSILON WITH HOOK SYMBOL      & 03D2\\
upsi               &  SMALL LETTER UPSILON          & 03C5\\
Xi                 &  CAPITAL LETTER XI             & 039E\\
xi                 &  SMALL LETTER XI               & 03BE\\
zeta               &  SMALL LETTER ZETA             & 03B6\\
\end{longtable}
\endinput
% end of r-longtable.tex
\end{filecontents}
\documentclass{book}

\usepackage{mathtext}
\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[english,russian]{babel}

\advance\textwidth.5in
\advance\evensidemargin-.25in
\advance\oddsidemargin-.25in

\usepackage[labelsep=newline]{caption}
\usepackage{floatrow}
\usepackage{array,fr-longtable}
\providecommand\floatsetup[2][]{}
\floatsetup[longtable]{font={small,sf},LTcapwidth=table,margins=centering,
    captionskip=5pt}
\captionsetup[longtable]{font=small}

\DeclareCaptionLabelFormat{labelcontI}%
  {\rightline{\bothIfFirst{#1}{ }#2 (\emph{продолжение})}}
\DeclareCaptionLabelFormat{labelfinI}%
  {\rightline{\bothIfFirst{#1}{ }#2 (\emph{окончание})}}

\DeclareCaptionLabelFormat{labelcontIII}%
  {\rightline{\emph{Продолжение табл.} #2}}
\DeclareCaptionLabelFormat{labelfinIII}%
  {\rightline{\emph{Окончание табл.} #2}}
%
% Caption for continued head, \ldots
\newcommand\LTcontcaptionI[1]{%
 \captionsetup{labelformat=labelcontI}\caption[]{#1}}
%
% and caption for finished head. 
\newcommand\LTfincaptionI[1]{%
 \captionsetup{labelformat=labelfinI}\caption[]{#1}}
%
% Caption for continued head, \ldots
\newcommand\LTcontcaptionII{%
 \caption[]{\emph{Продолжение}}}
%
% and caption for finished head.
\newcommand\LTfincaptionII{%
 \caption[]{\emph{Окончание}}}
%
% Caption for continued head, \ldots
\newcommand\LTcontcaptionIII[1]{%
 \captionsetup{labelformat=labelcontIII}\caption[]{#1}}
%
% and caption for finished head.
\newcommand\LTfincaptionIII[1]{%
 \captionsetup{labelformat=labelfinIII}\caption[]{#1}}

\begin{document}

\chapter[Шапки и~подвалы в~окружении \texttt{longtable}]{Последняя шапка и~предпоследний подвал в~окружении \texttt{longtable}}

Данный файл демонстрирует примеры задания последней шапки и~предпоследнего подвала
в~многостраничной таблице \texttt{longtable}. Все примеры распечатываются различными кеглями только для того чтобы протестировать алгоритм подсчёта числа страниц в~таблице.

Общие настройки:
\begin{quote}\obeylines\parskip0pt
\verb|\floatsetup[longtable]{font={small,sf},LTcapwidth=table,|
\verb|    margins=centering,captionskip=5pt}|
\verb|\captionsetup[longtable]{font={small,rm}}|
\end{quote}
В~данном файле в~таблице используется рубленый шрифт, версия пакета \textsf{caption}~3.1
решает эту проблему. Для версии \textsf{caption}~3.0q, чтобы восстановить семейство
шрифта основного текста для подписи в~настройках подписи добавлена опция |rm|, восстанавливающая нормальный шрифт.

Помимо команд, определённых пакетом \textsf{fr-longtable}: \verb|\endlasthead|
для задания последней шапки и~\verb|\endprelastfoot| \cdash--- для предпоследнего подвала,
в~данном файле используются две специальные команды для табличных заголовков, использующих
стандартную команду \verb|\caption|: \verb|\LTcontcaption| \cdash--- для шапках"=продолжениях
и~\verb|\LTfincaption| для последней шапки. Во всех трёх примерах используются
различные их определения.

\section{Вариант~I}

Для первого примера определены специальные настройки для
нумерационной части табличного заголовка. Это задаётся в~преамбуле:
\begin{quote}\obeylines\parskip0pt
\verb|\DeclareCaptionLabelFormat{labelcontI}%|
\verb|  {\rightline{\bothIfFirst{#1}{ }#2 (\emph{продолжение})}}|
\verb|\DeclareCaptionLabelFormat{labelfinI}%|
\verb|  {\rightline{\bothIfFirst{#1}{ }#2 (\emph{окончание})}}|
\end{quote}

Код начала таблицы в~этом случае должен выглядеть так:
\begin{quote}\obeylines\parskip0pt
\verb|\begin{longtable}{@{}lll}|
\verb|\caption{The ISOGRK3 entity set and more more more more more more|
\verb|   more more more more more more more more more more more text}\\|
\verb|  \bfseries Entity  &\bfseries  Unicode Name&\bfseries  Unicode\\|
\verb|\hline|
\verb|\endfirsthead|
\verb|\captionsetup{labelformat=labelcontI}\caption[]{}\\|
\verb|  \bfseries Entity  &\bfseries  Unicode Name&\bfseries  Unicode\\|
\verb|\hline|
\verb|\endhead|
\verb|\captionsetup{labelformat=labelfinI}\caption[]{}\\|
\verb|  \bfseries Entity  &\bfseries  Unicode Name&\bfseries  Unicode\\|
\verb|\hline|
\verb|\endlasthead|
\verb|  \hline \multicolumn{3}{@{}r@{}}{(\emph{продолжение|
\verb|                                         на следующей странице})}|
\verb|\endfoot|
\verb|  \hline \multicolumn{3}{@{}r@{}}{(\emph{окончание|
\verb|                                         на следующей странице})}|
\verb|\endprelastfoot|
\verb|   \hline|
\verb|\endlastfoot|
\end{quote}

\begingroup
\floatsetup[longtable]{font={Large,sf}}
\let\LTcontcaption\LTcontcaptionI
\let\LTfincaption\LTfincaptionI
\input r-longtable.tex

\endgroup

\clearpage
\section{Вариант~II}

В~данном примере видно, что в~использовании специальных настроек
\verb|labelformat| нет необходимости.  И~преамбула таблицы может быть задана в~виде:
\begin{quote}\obeylines\parskip0pt
\verb|\begin{longtable}{@{}lll}|
\verb|\caption{The ISOGRK3 entity set and more more more more more more|
\verb|   more more more more more more more more more more more text}\\|
\verb|   \bfseries Entity &\bfseries  Unicode Name&\bfseries  Unicode\\|
\verb|\hline|
\verb|\endfirsthead|
\verb|\caption[]{\emph{Продолжение}}\\|
\verb|   \bfseries Entity &\bfseries  Unicode Name&\bfseries  Unicode\\|
\verb|\hline|
\verb|\endhead|
\verb|\caption[]{\emph{Окончание}}\\|
\verb|   \bfseries Entity &\bfseries  Unicode Name&\bfseries  Unicode\\|
\verb|\hline|
\verb|\endlasthead|
\verb|    \hline \multicolumn{3}{@{}r@{}}{\emph{Продолжение|
\verb|                                          на следующей странице}}|
\verb|\endfoot|
\verb|    \hline \multicolumn{3}{@{}r@{}}{\emph{Окончание|
\verb|                                          на следующей странице}}|
\verb|\endprelastfoot|
\verb|   \hline|
\verb|\endlastfoot|
\end{quote}

\begingroup
\captionsetup[table]{labelsep=period,singlelinecheck=no}
\let\LTcontcaption\LTcontcaptionII
\let\LTfincaption\LTfincaptionII
\input r-longtable.tex

\endgroup

\clearpage
\section{Вариант~III}

Для последнего примера определены специальные настройки для
нумерационной части табличного заголовка. Это задаётся в~преамбуле:
\begin{quote}\obeylines\parskip0pt
\verb|\DeclareCaptionLabelFormat{labelcontIII}%|
\verb|  {\rightline{\emph{Продолжение табл.} #2}}|
\verb|\DeclareCaptionLabelFormat{labelfinIII}%|
\verb|  {\rightline{\emph{Окончание табл.} #2}}|
\end{quote}

Код начала таблицы в~этом случае должен выглядеть так:
\begin{quote}\obeylines\parskip0pt
\verb|\begin{longtable}{@{}lll}|
\verb|\caption{The ISOGRK3 entity set and more more more more more more|
\verb|   more more more more more more more more more more more text}\\|
\verb|    \bfseries Entity&\bfseries  Unicode Name&\bfseries  Unicode\\|
\verb|\hline|
\verb|\endfirsthead|
\verb|\captionsetup{labelformat=labelcontIII}\caption[]{}\\|
\verb|    \bfseries Entity&\bfseries  Unicode Name&\bfseries  Unicode\\|
\verb|\hline|
\verb|\endhead|
\verb|\captionsetup{labelformat=labelfinIII}\caption[]{}\\|
\verb|    \bfseries Entity&\bfseries  Unicode Name&\bfseries  Unicode\\|
\verb|\hline|
\verb|\endlasthead|
\verb|  \hline \multicolumn{3}{@{}r@{}}{(\emph{продолжение|
\verb|                                         на следующей странице})}|
\verb|\endfoot|
\verb|  \hline \multicolumn{3}{@{}r@{}}{(\emph{окончание|
\verb|                                         на следующей странице})}|
\verb|\endprelastfoot|
\verb|   \hline|
\verb|\endlastfoot|
\end{quote}

\begingroup
\floatsetup[longtable]{font={scriptsize,sf}}
\let\scriptsize\tiny
\let\LTcontcaption\LTcontcaptionIII
\let\LTfincaption\LTfincaptionIII

\input r-longtable.tex

\endgroup

\listoftables

\end{document}
\endinput 